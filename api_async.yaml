asyncapi: 3.0.0
info:
  title: SmartHome Kafka
  version: 1.0.0
servers:
  production:
    host: localhost:9092
    description: Kafka broker running in a central warehouse
    protocol: kafka
channels:
  telemetry:
    messages:
      telemetry:
        payload:
          type: object
          properties:
            id:
              type: string
              format: uuid
            currentTemperature:
              type: number
            lastUpdated:
              type: string
              format: date-time
  devices:
    messages:
      command:
        payload:
          type: object
          properties:
            deviceId:
              type: string
              format: uuid
            type:
              type: string
            value:
              type: string
  registerDevice:
    address: "smarthome.1.0.event.register"
    description: Канал для сообщений о регистрации устройства
    messages:
      deviceRegistrationInfo:
        description: Сообщение с регистрационной информацией
        payload:
          type: object
          required:
            - providerId
            - userId
            - sentAt
          properties:
            providerId:
              type: string
              format: uuid
              description: Идентификатор провайдера.
            userId:
              type: string
              format: uuid
              description: ID пользователя.
            authCode:
              type: string
              format: base64
              description: Код авторизации.
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9
            sentAt:
              type: string
              format: date-time
              description: Дата и время отправки сообщения.
operations:
  sendTelemetry:
    action: send
    description: Отправка данных телеметрии из монолита
    channel:
      $ref: "#/channels/telemetry"
  receiveTelemetry:
    action: receive
    description: Получение данных телеметрии в сервисе телеметрии
    channel:
      $ref: "#/channels/telemetry"
  sendDeviceCommand:
    action: send
    description: Отправка команды из сервиса управления устройствами
    channel:
      $ref: "#/channels/devices"
  receiveDeviceCommand:
    action: receive
    description: Получение команды в монолите
    channel:
      $ref: "#/channels/telemetry"
  sendRegisterDevice:
    action: send
    description: Операция по отправке сообщений о регистрации устройства
    channel:
      $ref: "#/channels/registerDevice"
  receiveRegisterDevice:
    action: receive
    description: Операция по получению сообщений о регистрации цстройства
    channel:
      $ref: "#/channels/registerDevice"
